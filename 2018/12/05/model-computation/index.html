<!DOCTYPE html>




<html class="theme-next gemini" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/butterfly_128.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/butterfly_64.ico?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="机器学习，深度学习，Machine Learning, Deep Learning">










<meta name="description" content="模型占用的存储空间、模型运行时消耗的内存空间、模型运行的速度  1. CNN不同层的计算量了解模型计算量的一种简单方法就是计算这个模型总共做了多少次浮点运算。除了计算量，内存带宽也是影响计算效率的重要因素。   1.1 乘积相加神经网络中的绝大多数操作都是浮点数的乘法进行求和。例如： y = w[0]*x[0] + w[1]*x[1] + w[2]*x[2] + ... + w[n-1]*x[n">
<meta property="og:type" content="article">
<meta property="og:title" content="你的模型运行快吗？">
<meta property="og:url" content="http://zhongneng.github.io/2018/12/05/model-computation/index.html">
<meta property="og:site_name" content="旅途札记">
<meta property="og:description" content="模型占用的存储空间、模型运行时消耗的内存空间、模型运行的速度  1. CNN不同层的计算量了解模型计算量的一种简单方法就是计算这个模型总共做了多少次浮点运算。除了计算量，内存带宽也是影响计算效率的重要因素。   1.1 乘积相加神经网络中的绝大多数操作都是浮点数的乘法进行求和。例如： y = w[0]*x[0] + w[1]*x[1] + w[2]*x[2] + ... + w[n-1]*x[n">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://zhongneng.github.io/2018/12/05/model-computation/convolution.png">
<meta property="og:image" content="http://zhongneng.github.io/2018/12/05/model-computation/depthwise_convolution.png">
<meta property="og:image" content="http://zhongneng.github.io/2018/12/05/model-computation/pointwise_convolution.png">
<meta property="og:updated_time" content="2018-12-05T11:52:08.410Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="你的模型运行快吗？">
<meta name="twitter:description" content="模型占用的存储空间、模型运行时消耗的内存空间、模型运行的速度  1. CNN不同层的计算量了解模型计算量的一种简单方法就是计算这个模型总共做了多少次浮点运算。除了计算量，内存带宽也是影响计算效率的重要因素。   1.1 乘积相加神经网络中的绝大多数操作都是浮点数的乘法进行求和。例如： y = w[0]*x[0] + w[1]*x[1] + w[2]*x[2] + ... + w[n-1]*x[n">
<meta name="twitter:image" content="http://zhongneng.github.io/2018/12/05/model-computation/convolution.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://zhongneng.github.io/2018/12/05/model-computation/">





  <title>你的模型运行快吗？ | 旅途札记</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">旅途札记</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">算法菜鸟的攻城狮之路</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://zhongneng.github.io/2018/12/05/model-computation/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhong Neng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/picture.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="旅途札记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">你的模型运行快吗？</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-05T16:22:22+08:00">
                2018-12-05
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/深度学习/" itemprop="url" rel="index">
                    <span itemprop="name">深度学习</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i> 阅读次数
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>次
            </span>
          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  2.1k
                </span>字
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  8
                </span>分钟
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote>
<p>模型占用的存储空间、模型运行时消耗的内存空间、模型运行的速度</p>
</blockquote>
<h1 id="1-CNN不同层的计算量"><a href="#1-CNN不同层的计算量" class="headerlink" title="1. CNN不同层的计算量"></a>1. CNN不同层的计算量</h1><p>了解模型计算量的一种简单方法就是计算这个模型总共做了多少次浮点运算。除了计算量，内存带宽也是影响计算效率的重要因素。  </p>
<h2 id="1-1-乘积相加"><a href="#1-1-乘积相加" class="headerlink" title="1.1 乘积相加"></a>1.1 乘积相加</h2><p>神经网络中的绝大多数操作都是浮点数的乘法进行求和。例如：</p>
<pre><code class="lang-bash">y = w[0]*x[0] + w[1]*x[1] + w[2]*x[2] + ... + w[n-1]*x[n-1]
</code></pre>
<p>上式中，输入 <code>w</code> 和 <code>x</code> 是两个向量，输出 <code>y</code> 是一个标量 ( 实数 )。在神经网络的卷积层和全连接层中， <code>w</code> 是层学习到的参数，<code>x</code> 就是层的输入，而 <code>y</code> 则是层的输出的一部分，因为典型的层结构有多个输出。其中 <code>w[0]*x[0] + ...</code> 称为一次 <a href="https://en.wikipedia.org/wiki/Multiply%E2%80%93accumulate_operation" target="_blank" rel="noopener">乘积相加操作(multiply-accumulate operations)</a>, 因此两个 <code>n</code> 维向量的点积含有 <code>n</code> 个 MACCs(乘积相加) 计算单元。</p>
<blockquote>
<p>Technically speaking there are only n - 1 additions in the above formula, one less than the number of multiplications. Think of the number of MACCs as being an approximation, just like Big-O notation is an approximation of the complexity of an algorithm.</p>
</blockquote>
<p>从每秒浮点运算 ( floating point operations per second, FLOPS ) 的角度来看，一次点积操作包含 <code>2n-1</code> 个 FLOPS，因为其中含有 <code>n</code> 次乘法运算和 <code>n-1</code> 次加法运算。</p>
<h2 id="1-2-全连接层"><a href="#1-2-全连接层" class="headerlink" title="1.2 全连接层"></a>1.2 全连接层</h2><p>在全连接层，所有的输入单元和输出单元相互连接。对于含有 <code>I</code> 个输入值和 <code>J</code> 个输出值的的层，权重 <code>W</code> 存储在 <code>I×J</code> 的矩阵中，因此全连接层的计算可以写作：</p>
<pre><code>y = matmul(x, W) + b
</code></pre><p>矩阵乘法是有一系列点乘组合而成的。每一个点乘由输入 <code>x</code> 和矩阵<code>W</code> 的每一列运算得到。因此运算 <code>matmul(x, W)</code> 包含 <code>I×J</code> 个 MACCs 单元，和权重矩阵的元素个数相同。例如卷积层的最后输出为 <code>(512, 7, 7)</code>, 那么经过 <code>faltten</code> 操作后，输入 <code>I=512x7x7</code>。</p>
<h2 id="1-3-激活函数"><a href="#1-3-激活函数" class="headerlink" title="1.3 激活函数"></a>1.3 激活函数</h2><p>通常层的后面会跟随非线性激活函数，例如 ReLU 或者 sigmoid 函数。由于激活函数没有乘法运算，因此使用 FLOPS 来衡量计算时间。<br>不同激活函数的计算量是不同的。ReLU 激活函数的表达式为：</p>
<pre><code>y = max(x, 0)
</code></pre><p>在 GPU 上只有一次操作。假设全连接层有 <code>J</code> 个输出单元，ReLU函数进行了 <code>J</code> 次最大值操作，因此含有 <code>J</code> 个 FLOPS 单元。<br>Sigmoid 激活函数表达式为：</p>
<pre><code>y = 1 / (1 + exp(-x))
</code></pre><p>由于 Sigmoid 函数包含幂运算，因此计算量比较复杂。通常将加法运算、减法运算、乘法运算、除法运算、幂运算和平方根运算称为一次 FLOPS。Sigmoid 函数中包含四种不同的运算操作，因此含有 4 次 FLOPS。假设全连接层有 <code>J</code> 个输出单元，那么Sigmoid 函数含有 <code>4xJ</code> 个 FLOPS 单元。通常激活函数只占模型总运算量的很小一部分。</p>
<h2 id="1-3-卷积层"><a href="#1-3-卷积层" class="headerlink" title="1.3 卷积层"></a>1.3 卷积层</h2><p>卷积层的输入和输出不是向量，而是三维 ( <code>Height*Width*Channels</code> ) 的特征图。假定正方形的卷积核边长为 <code>k</code>，那么卷积层不考虑偏置和激活函数的 MACCs 为：</p>
<pre><code>k × k × Channels_in × Height_out × Width_out × Channels_out
</code></pre><p>这里使用输出的 <code>Height</code> 和 <code>Width</code> 是因为考虑到卷积时的<code>stride, dilation factors, padding, etc</code>。<br>对于卷积核为为 <code>(3, 3, 128)</code> 且输入为 <code>(112, 112, 64)</code> 的卷积计算， 它的 MACCs 为：</p>
<pre><code>3 × 3 × 64 × 112 × 112 × 128 = 924844032
</code></pre><blockquote>
<p>In this example, we used “same” padding and stride = 1, so that the output feature map has the same size as the input feature map. It’s also common to see convolutional layers use stride = 2, which would have chopped the output feature map size in half, and we would’ve used 56 × 56 instead of 112 × 112 in the above calculation.</p>
</blockquote>
<h2 id="1-4-深度可分离卷积"><a href="#1-4-深度可分离卷积" class="headerlink" title="1.4 深度可分离卷积"></a>1.4 深度可分离卷积</h2><p>深度可分离卷积 ( depthwise-separable convolution ) 首先在 <a href="https://arxiv.org/abs/1610.02357" target="_blank" rel="noopener">Xception</a> 中被使用，它将常规的卷积操作分解为 depthwise 卷积与 pointwise 卷积两个部分。该结构和常规提取特征的卷积操作类似，但是参数量和运算成本较低，在轻量级网络 ( <a href="https://arxiv.org/abs/1704.04861" target="_blank" rel="noopener">MobileNet</a> )中十分常见。  </p>
<p>假设输入层为 <code>(112, 112, 64)</code>，经过 <code>(3, 3, 128)</code>的卷积核，假定使用 <code>same padding</code> 并且 <code>stride=1</code>，使得输入输出特征图大小相同，那么最终得到 <code>(112, 112, 128)</code> 的特征图。常规卷积示意图如下所示。 MACCs 次数为：</p>
<pre><code>3 × 3 × 64 × 112 × 112 × 128 = 924844032
</code></pre><div align="center"><img src="/2018/12/05/model-computation/convolution.png" alt="卷积示意图" width="400" height="300"></div>

<p>Depthwise Convolution 的每个卷积核只与输入的一个通道进行卷积，卷积核的数量与上一层的通道数相同。因此输入图像经过 depthwise 卷积之后生成 3 个单通道的特征图，如下图所示。</p>
<pre><code>MACCs = K × K × Channels_in × Height_out × Width_out
      = 3 × 3 × 64 × 112 × 112 
      = 7225344
</code></pre><div align="center"><img src="/2018/12/05/model-computation/depthwise_convolution.png" alt="卷积示意图" width="400" height="300"></div>

<p>Depthwise Convolution 完成后的特征图数量与输入层的通道数相同，无法扩展特征图的数量，而且无法有效利用不同通道在相同空间位置上的特征信息。因此在 depthwise 卷积之后需要 pointwise Convolution 将特征图进行组合生成新的特征图。Pointwise Convolution 的卷积核大小为 <code>1x1</code>。</p>
<pre><code>MACCs = 1 × 1 × Channels_in × Height_out × Width_out x Channels_out
      = 1 × 1 × 64 × 112 × 112 x 128 
      = 102760448
</code></pre><div align="center"><img src="/2018/12/05/model-computation/pointwise_convolution.png" alt="卷积示意图" width="400" height="300"></div>

<p>因此 depthwise-separable convolution 的 MACCs 为：</p>
<pre><code>MACCs = (K × K × Channels_in × Height_out × Width_out) + (Channels_in × Height_out × Width_out × Channels_out) 
      = Channels_in × Height_out × Width_out × (K × K + Channel_out)
</code></pre><blockquote>
<p>The exact factor is <code>K × K × Cout / (K × K + Cout)</code> . It should be pointed out that depthwise convolutions sometimes have a <code>stride &gt; 1</code>, which reduces the dimensions of their output feature map. But a pointwise layer usually has <code>stride = 1</code>, and so its output feature map will always have the same dimensions as the depthwise layer’s.</p>
</blockquote>
<h2 id="1-5-批量归一化层"><a href="#1-5-批量归一化层" class="headerlink" title="1.5 批量归一化层"></a>1.5 批量归一化层</h2><p>批量归一化层 ( Batch normalization Layer) 每一个输出的函数表达式可以写为：</p>
<pre><code>z = gamma * (y - mean) / sqrt(variance + epsilon) + beta
</code></pre><p>其中 <code>y</code> 是上一层输出特征图的一个元素，mean 为均值，variance 为方差，epsilon 确保分母不为0，gamma为尺度因子，beta 为偏置。每一个通道都有其对应的值，因此对于通道为 <code>c</code> 的卷积输出层，batch normalization layer 学习的参数量为 <code>4c</code>。</p>
<pre><code>z = gamma * ((x[0]*w[0] + x[1]*w[1] + ... + x[n-1]*w[n-1] + b) - mean) / sqrt(variance + epsilon) + beta
</code></pre><p>由于在预测过程中移除了 batch normlization layer，因此考虑模型的计算量时可以不用关注正则化层的影响。</p>
<blockquote>
<p> This trick only works when the order of the layers is: convolution, batch norm, ReLU — but not when it is: convolution, ReLU, batch norm. The ReLU is a non-linear operation, which messes up the math.</p>
</blockquote>
<h2 id="1-6-池化层"><a href="#1-6-池化层" class="headerlink" title="1.6 池化层"></a>1.6 池化层</h2><p>对于 <code>112, 112, 128)</code> 的特征图，如果最大池化的 <code>pooling size = 2</code> 并且 <code>stride = 2</code>，那么 FLOPS 操作数为 <code>112 × 112 × 128 = 1605632</code>。可以看到，池化层的操作数远远少于卷积层的操作数，因此池化层也是网络计算复杂度的舍入误差。</p>
<h1 id="2-模型耗费的内存"><a href="#2-模型耗费的内存" class="headerlink" title="2. 模型耗费的内存"></a>2. 模型耗费的内存</h1><p>在模型的每一层计算中，硬件设备需要从主存储中读取输入向量或者特征图的值，从主存储中读取权重参数并与输入计算点积，将得到的新向量或者特征图作为结果写入主存储中。这些操作都涉及到大量的内存读写，耗费的时间可能远远大于计算的次数。</p>
<h2 id="2-1-权重的内存"><a href="#2-1-权重的内存" class="headerlink" title="2.1 权重的内存"></a>2.1 权重的内存</h2><p>层将权重保存在主存储中，这意味着权重参数越少，模型运行速度越快。如前文所述，输入为 <code>I</code> 个神经元和输出为 <code>J</code> 个神经元之间的权重参数为 <code>I x J</code>，加上偏置向量，总的参数为 <code>( I + 1) x J</code>。对于大小为 <code>k</code>，输入通道数为 <code>Channels_in</code>，输出通道数为 <code>Channels_out</code> 的卷积层的参数为 <code>k x k Channels_in x Channels_out</code> 加上偏置向量参数 <code>Channels_out</code>。<br>对于输入 <code>4096</code> 输出为 <code>4096</code>的全连接层，其权重参数量为 <code>(4096 + 1) x 4096 = 16781312</code>。对于输入为 <code>(64, 64, 32)</code> 卷积核为 <code>(3, 3, 48)</code> 的卷积层，其权重参数量为 <code>(3 x 3 x 32 x 48 + 48 = 13872)</code>。可以看到，相比于卷积层，全连接层的参数量相对更多。</p>
<blockquote>
<p>Fully-connected and convolutional layers are actually very similar. A convolutional layer is basically a fully-connected layer with the vast majority of the connections set to 0 — each output is only connected to K × K inputs rather than all of them, and all the outputs use the same values for these connections. This is why convolutional layers are so much more efficient about memory, since they don’t store the weights for connections that are not used.</p>
</blockquote>

      
    </div>
    
    
    

    <div>
      
        <div>
    
        <div style="text-align:center;color: #458B00;font-size:14px;">-------------本文结束  感谢阅读-------------</div>
    
</div>

      
    </div>

    



    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/12/04/docker-env/" rel="next" title="Centos7使用Docker快速搭建深度学习环境">
                <i class="fa fa-chevron-left"></i> Centos7使用Docker快速搭建深度学习环境
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/12/13/introduction-ml/" rel="prev" title="机器学习简介">
                机器学习简介 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/picture.jpg" alt="Zhong Neng">
            
              <p class="site-author-name" itemprop="name">Zhong Neng</p>
              <p class="site-description motion-element" itemprop="description">Machine Learning</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">15</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">14</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/zhongneng" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:zhongneng.whu@qq.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-CNN不同层的计算量"><span class="nav-text">1. CNN不同层的计算量</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-乘积相加"><span class="nav-text">1.1 乘积相加</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-全连接层"><span class="nav-text">1.2 全连接层</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-激活函数"><span class="nav-text">1.3 激活函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-卷积层"><span class="nav-text">1.3 卷积层</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-4-深度可分离卷积"><span class="nav-text">1.4 深度可分离卷积</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-5-批量归一化层"><span class="nav-text">1.5 批量归一化层</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-6-池化层"><span class="nav-text">1.6 池化层</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-模型耗费的内存"><span class="nav-text">2. 模型耗费的内存</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-权重的内存"><span class="nav-text">2.1 权重的内存</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="heart">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zhong Neng</span>

  
</div>

<div id="days"></div>
<script language="javascript">
  function show_date_time(){
    window.setTimeout("show_date_time()", 1000);
  }
    BirthDay=new Date("11/11/2018 11:11:11");
    today=new Date();
    timeold=(today.getTime()-BirthDay.getTime());
    sectimeold=timeold/1000
    secondsold=Math.floor(sectimeold);
    msPerDay=24*60*60*1000
    e_daysold=timeold/msPerDay
    daysold=Math.floor(e_daysold);
    e_hrsold=(e_daysold-daysold)*24;
    hrsold=setzero(Math.floor(e_hrsold));
    e_minsold=(e_hrsold-hrsold)*60;
    minsold=setzero(Math.floor((e_hrsold-hrsold)*60));
    seconds=setzero(Math.floor((e_minsold-minsold)*60));
    document.getElementById('days').innerHTML="安全运行"+daysold+"天"+hrsold+"小时"+minsold+"分"+seconds+"秒";
  }
  function setzero(i){
    if (i<10)
    {i="0" + i};
    return i;
  }
  show_date_time();
</script>











        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i> 访问数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      人
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i> 访问量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('2');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  
  


  

  

</body>
</html>

<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/clicklove.js"></script>




<!-- google-code-prettify代码高亮 -->
<!-- <link rel="stylesheet" href="/lib/google-code-prettify/skins/sons-of-obsidian.css" type="text/css"> -->
<link rel="stylesheet" href="/lib/google-code-prettify/skins/sons-of-obsidian.css" type="text/css">
<script src="/lib/google-code-prettify/prettify.js" type="text/javascript"></script>
<script type="text/javascript">
  $(document).ready(function() {
      $('pre').addClass('prettyprint linenums').attr('style', 'overflow:auto;');
      prettyPrint();
  });
</script>
